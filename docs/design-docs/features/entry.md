# 概要

エントリー機能を作成する.

# 対象範囲

## 達成基準

- エントリーの作成, 更新, 削除, 取得ができる状態

## 除外項目

- 認可機能は対応しない
- ボディの取得機能は対応しない

# 利用方法

## エンドポイント

| パス | メソッド | 備考 |
| --- | --- | --- |
| /entries | POST | エントリー作成 |
| /entries | GET | エントリー一覧取得 |
| /entries/:id | POST | エントリー更新 |
| /entries/:id | DELETE | エントリー削除 |
| /entries/:id | GET | エントリー単体取得 |

# 詳細設計

ファイル情報をEntry、ファイルボディをBodyとする.
Bodyはドメインオブジェクトとして扱わず、インフラ層で管理を行う.

## 要件

- ボリュームIDとキー、公開フラグとボディを入力しエントリーの作成を行う
- キーと公開フラグの更新が行える
- エントリーの削除が行える
- エントリーの一覧, 単体取得が行える
  - 公開フラグがTrueの場合は認証無しでボディの取得が行える

## 仕様

- ボディがないエントリーはフォルダとする
- キーはグローバルに一意となる
  - ボリュームIDとキーの組み合わせでグローバルに一意となる
- キーは1文字以上255文字以下かつ\\/:*?"<>|は利用不可

## ドメインオブジェクト

### Entry

| キー | 型 | 備考 |
| --- | --- | --- |
| ID | uuid.UUID | |
| AccountID | uuid.UUID | |
| VolumeID | uuiid.UUID | |
| Key | string | 1文字以上255文字以下<br />\\:*?"<>\|は利用不可 |
| Size | uint64 | |
| Type | string | MIMEタイプまたはFolder |
| IsPublic | bool | |
| CreatedAt | time.Time | |
| UpdatedAt | time.Time | |

## テーブル

| カラム名 | 型 | キー | null許容 | 備考 |
| --- | --- | --- | --- | --- |
| id | char(36) | PK | | ID |
| account_id | char(36) | | | アカウントID |
| volume_id | char(36) | FK | | ボリュームID |
| key | varchar(255) | | | キー |
| size | bigint unsigned | | | サイズ |
| type | varchar(255) | | | タイプ |
| is_public | tinyint(1) | | | 公開フラグ |
| created_at | datetime(6) | | | 作成日時 |
| updated_at | datetime(6) | | | 更新日時 |

## テスト項目

### キー

#### 有効値判定

| ステータス | テストケース | 入力値 |
| --- | --- | --- |
| 正常系 | 小文字のローマ字のみ | key |
| 正常系 | 大文字のローマ字のみ | KEY |
| 正常系 | 数字のみ | 1234 |
| 正常系 | 小文字, 大文字, 数字の混在 | entryKey01 |
| 正常系 | 有効な記号が含まれる | !@#$%^&()_-+=[]{};',.~ |
| 正常系 | スペースが含まれる | entry key |
| 正常系 | スラッシュが含まれる | entry/key |
| 異常系 | バックスラッシュが含まれる | entry\key |
| 異常系 | コロンが含まれる | entry:key |
| 異常系 | アスタリスクが含まれる | entry*key |
| 異常系 | クエスションマークが含まれる | entry?key |
| 異常系 | ダブルクォーテーションが含まれる | entry"key |
| 異常系 | 大なり記号が含まれる | entry>key |
| 異常系 | 小なり記号が含まれる | entry<key |
| 異常系 | バーティカルバーが含まれる | entry\|key |
| 異常系 | ひらがな | きー |
| 異常系 | カタカナ | キー |
| 異常系 | 漢字 | 識別子 |
| 異常系 | 2文字 | strings.Repeat("a", 2) |
| 正常系 | 3文字 | strings.Repeat("a", 3) |
| 正常系 | 24文字 | strings.Repeat("a", 24) |
| 異常系 | 25文字 | strings.Repeat("a", 25) |

#### 重複判定

| ステータス | テストケース | 入力値 |
| --- | --- | --- |
| 正常系 | エントリーが存在しない | 重複確認mockの戻り値がnil |
| 異常系 | エントリーが存在する | 重複確認mockの戻り値がerror |

# その他の手法

# 参考文献

# 変更履歴

| 変更日 | 変更者 | 変更内容 |
| --- | --- | --- |
| 2025/04/26 | @atsumarukun | 初版 |
